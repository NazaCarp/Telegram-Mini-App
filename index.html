const webApp = window.Telegram.WebApp;
webApp.ready();

let currentCounter = 0;
const userId = webApp.initDataUnsafe.user.id;

const updateCounterDisplay = (value) => {
    document.getElementById('counter').textContent = value;
};

const fetchCounter = async () => {
    const response = await fetch(`/get_counter?user_id=${userId}`);
    const data = await response.json();
    if (data.error) {
        console.error(data.error);
        return;
    }
    currentCounter = data.value;
    updateCounterDisplay(currentCounter);
};

document.getElementById('incrementButton').addEventListener('click', async () => {
    currentCounter += 1;
    updateCounterDisplay(currentCounter);

    const response = await fetch('/update_counter', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ user_id: userId, value: currentCounter })
    });

    const data = await response.json();
    if (data.error) {
        console.error(data.error);
    }
});

fetchCounter();